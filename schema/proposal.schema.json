{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Proposal Record",
  "type": "object",
  "additionalProperties": false,

  "properties": {
    "proposal_id": {
      "type": "string",
      "minLength": 1,
      "description": "Unique identifier for the proposal"
    },

    "proposer": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": ["string", "null"],
          "description": "Name of proposer or MASKED",
          "pattern": "^[A-Za-z ]+$"
        },
        "email": {
          "type": ["string", "null"],
          "format": "email",
          "description": "Email address of proposer or MASKED"
        }
      }
    },

    "premises": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "address": {
          "type": ["string", "null"],
          "description": "Risk location address or MASKED"
        },
        "construction_type": {
          "type": ["string", "null"],
          "description": "Construction details (e.g., RCC, brick, mixed)"
        }
      }
    },

    "security": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "has_security": {
          "type": "boolean",
          "description": "Whether any security arrangements exist"
        },

        "cctv": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "installed": { "type": ["boolean", "null"] },
            "coverage_areas": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        },

        "alarm_system": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "installed": { "type": ["boolean", "null"] },
            "type": {
              "type": ["string", "null"],
              "description": "Burglar / Fire / Combined"
            }
          }
        },

        "guards": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "present": { "type": ["boolean", "null"] },
            "armed": { "type": ["boolean", "null"] }
          }
        }
      },
      "required": ["has_security"]
    },

    "claims_history": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "has_claims": {
          "type": ["boolean", "null"],
          "description": "Whether claims exist in past years"
        },
        "remarks": {
          "type": ["string", "null"],
          "description": "Claim details or NIL"
        }
      }
    }
  },

  "required": ["proposal_id", "security"],

  "allOf": [
    {
      "if": {
        "properties": {
          "security": {
            "properties": {
              "has_security": { "const": true }
            }
          }
        }
      },
      "then": {
        "properties": {
          "security": {
            "required": ["cctv", "alarm_system"]
          }
        }
      }
    }
  ]
}
